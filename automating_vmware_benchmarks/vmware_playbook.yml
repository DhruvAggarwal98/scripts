---
- hosts: localhost
  gather_facts: false

  tasks: 
  - name: |
      .
      Control-ID: 1.1
      Title: (L1) Ensure ESXi is properly patched
      Description: VMware Update Manager is a tool used to automate patch management for vSphere hosts and virtual machines. Creating a baseline for patches is a good way to ensure all hosts are at the same patch level. VMware also publishes advisories on security patches and offers a way to subscribe to email alerts for them.
      Rationale: By staying up to date on ESXi patches, vulnerabilities in the hypervisor can be mitigated. An educated attacker can exploit known vulnerabilities when attempting to attain access or elevate privileges on an ESXi host.
      module:

  - name: |
      .
      Control-ID: 1.2
      Title: (L1) Ensure the Image Profile VIB acceptance level is configured properly
      Description: A VIB (vSphere Installation Bundle) is a collection of files that are packaged into an archive. The VIB contains a signature file that is used to verify the level of trust. The ESXi Image Profile supports four VIB acceptance levels:  1. VMware Certified - VIBs created, tested, and signed by VMware 2. VMware Accepted - VIBs created by a VMware partner but tested and signed by VMware 3. Partner Supported - VIBs created, tested, and signed by a certified VMware partner 4. Community Supported - VIBs that have not been tested by VMware or a VMware partner
      Rationale: The ESXi Image Profile should only allow signed VIBs because an unsigned VIB represents untested code installed on an ESXi host. Also, use of unsigned VIBs will cause hypervisor Secure Boot to fail to configure. Community Supported VIBs do not have digital signatures. To protect the security and integrity of your ESXi hosts, do not allow unsigned (CommunitySupported) VIBs to be installed on your hosts.
      module:

  - name: |
      .
      Control-ID: 1.3
      Title: (L1) Ensure no unauthorized kernel modules are loaded on the host
      Description: ESXi hosts by default do not permit the loading of kernel modules that lack valid digital signatures. This feature can be overridden, which would allow unauthorized kernel modules to be loaded.
      Rationale: VMware provides digital signatures for kernel modules. Untested or malicious kernel modules loaded on the ESXi host can put the host at risk for instability and/or exploitation.
      module:

  - name: |
      .
      Control-ID: 1.4
      Title: (L1) Ensure the default value of individual salt per vm is configured
      Description: The concept of salting has been introduced to help address concerns system administrators may have over the security implications of TPS. As per the original TPS implementation, multiple virtual machines could share pages when the contents of the pages were same. With the new salting settings, the virtual machines can share pages only if the salt value and contents of the pages are identical. A new host config option Mem.ShareForceSalting is introduced to enable or disable salting.  By default, salting is enabled (Mem.ShareForceSalting=2) and each virtual machine has a different salt. This means page sharing does not occur across the virtual machines (inter-VM TPS) and only happens inside a virtual machine (intra VM).
      Rationale: Intra-VM means that TPS will de-duplicate identical pages of memory within a virtual machine, but will not share the pages with any other virtual machines. Ensuring the default setting is in place so that page sharing only occurs inside a virtual machine is the best option here.
      module:

  - name: |
      .
      Control-ID: 2.1
      Title: (L1) Ensure NTP time synchronization is configured properly
      Description: Network Time Protocol (NTP) synchronization should be configured correctly and enabled on each VMware ESXi host to ensure accurate time for system event logs. The time sources used by the ESXi hosts should be in sync with an agreed-upon time standard such as Coordinated Universal Time (UTC). There should be at minimum two NTP sources in place, and they should sync whenever possible.
      Rationale: By ensuring that all systems use the same relative time source (including the relevant localization offset), and that the relative time source can be correlated to an agreed-upon time standard, it is simpler to track and correlate an intruder's actions when reviewing the relevant log files. Incorrect time settings can also make auditing inaccurate.
      module:

  - name: |
      .
      Control-ID: 2.2
      Title: (L1) Ensure the ESXi host firewall is configured to restrict access to services running on the host
      Description: The ESXi firewall is enabled by default and allows ping (ICMP) and communication with DHCP/DNS clients. Access to services should only be allowed by authorized IP addresses/networks.
      Rationale: Unrestricted access to services running on an ESXi host can expose a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to only allow access from authorized IP addresses and networks.
      module:

  - name: |
      .
      Control-ID: 2.3
      Title: (L1) Ensure Managed Object Browser (MOB) is disabled
      Description: The Managed Object Browser (MOB) is a web-based server application that lets you examine objects that exist on the server side, explore the object model used by the VM kernel to manage the host, and change configurations. It is installed and started automatically when vCenter is installed.
      Rationale: The MOB is meant to be used primarily for debugging the vSphere SDK. Because there are no access controls, the MOB could also be used as a method to obtain information about a host being targeted for unauthorized access.
      module:

  - name: |
      .
      Control-ID: 2.4
      Title: (L1) Ensure default self-signed certificate for ESXi communication is not used
      Description: The default certificate is self-signed, not signed by a trusted certificate authority (CA). It should be replaced with a valid certificate issued by a trusted CA.
      Rationale: Using the default self-signed certificate may increase risk related to man-in-the-middle (MITM) attacks.
      module:

  - name: |
      .
      Control-ID: 2.5
      Title: (L1) Ensure SNMP is configured properly
      Description: Simple Network Management Protocol (SNMP) can be used to help manage hosts. Many organizations have other means in place of managing hosts and do not need SNMP enabled. If SNMP is needed, it should be configured properly to reduce the risk of misuse or compromise. For example, ESXi supports SNMPv3, which provides stronger security than SNMPv1 or SNMPv2, including key authentication and encryption. It is also important to configure the destination for SNMP traps.
      Rationale: If SNMP is not properly configured, monitoring data containing sensitive information can be sent to a malicious host and used to help exploit the host.
      module:

  - name: |
      .
      Control-ID: 2.6
      Title: (L1) Ensure dvfilter API is not configured if not used
      Description: The dvfilter network API is used by some products (e.g., VMSafe). If it is not in use, it should not be configured to send network information to a VM.
      Rationale: If the dvfilter network API is enabled in the future and it is already configured, an attacker might attempt to connect a VM to it, thereby potentially providing access to the network of other VMs on the host.
      module:

  - name: |
      .
      Control-ID: 2.7
      Title: (L1) Ensure expired and revoked SSL certificates are removed from the ESXi server
      Description: By default, ESXi hosts do not have Certificate Revocation List (CRL) checking available, so expired and revoked SSL certificates must be checked and removed manually.
      Rationale: Leaving expired and revoked certificates on your vCenter Server system can compromise your environment. Replacing certificates will avoid having users get used to clicking through browser warnings. The warning might be an indication of a man-in-the-middle attack, and only inspection of the certificate and thumbprint can guard against such attacks.
      module:

  - name: |
      .
      Control-ID: 2.8
      Title: (L1) Ensure vSphere Authentication Proxy is used when adding hosts to Active Directory
      Description: vSphere Authentication Proxy enables ESXi hosts to join a domain without using Active Directory credentials. vSphere Authentication Proxy enhances security for PXE-booted hosts and hosts that are provisioned using Auto Deploy and Host profiles, by removing the need to store Active Directory credentials in the host configuration.  The vSphere Authentication Proxy service binds to an IPv4 address for communication with vCenter Server, and does not support IPv6. The vCenter Server can be on a host machine in an IPv4-only, IPv4/IPv6 mixed-mode, or IPv6-only network environment, but the machine that connects to the vCenter Server through the vSphere Client must have an IPv4 address for the vSphere Authentication Proxy service to work.
      Rationale: If you configure your host to join an Active Directory domain using Host Profiles the Active Directory credentials are saved in the host profile and are transmitted over the network. To avoid having to save Active Directory credentials in the Host Profile and to avoid transmitting Active Directory credentials over the network use the vSphere Authentication Proxy.
      module:

  - name: |
      .
      Control-ID: 2.9
      Title: (L1) Ensure VDS health check is disabled
      Description: The health check support in VDS helps you identify and troubleshoot configuration errors in a vSphere Distributed Switch. It is recommended that health check be turned off by default and confirmed that it is turned off when troubleshooting is finished.
      Rationale: vSphere Distributed switch health check once enabled, collects packets that contain information on host#, vds# port#, which an attacker would find useful.
      module:

  - name: |
      .
      Control-ID: 3.1
      Title: (L1) Ensure a centralized location is configured to collect ESXi host core dumps
      Description: The VMware vSphere Network Dump Collector service allows for collecting diagnostic information from a host that experiences a critical fault. This service provides a centralized location for collecting ESXi host core dumps.
      Rationale: When a host crashes, an analysis of the resultant core dump is essential to being able to identify the cause of the crash and determine a resolution. Installing a centralized dump collector helps ensure that core files are successfully saved and made available in the event an ESXi host should ever panic.
      module:

  - name: |
      .
      Control-ID: 3.2
      Title: (L1) Ensure persistent logging is configured for all ESXi hosts
      Description: ESXi can be configured to store log files on an in-memory file system. This occurs when the host's `Syslog.global.LogDir` property is set to a non-persistent location, such as `/scratch.` When this is done, only a single day's worth of logs are stored at any time. Additionally, log files will be reinitialized upon each reboot.
      Rationale: Non-persistent logging presents a security risk because user activity logged on the host is only stored temporarily and will not be preserved across reboots. This can also complicate auditing and make it harder to monitor events and diagnose issues. ESXi host logging should always be configured to a persistent datastore.
      module:

  - name: |
      .
      Control-ID: 3.3
      Title: (L1) Ensure remote logging is configured for ESXi hosts
      Description: By default, ESXI logs are stored on a local scratch volume or ramdisk. To preserve logs, also configure remote logging to a central log host for the ESXI hosts.
      Rationale: Remote logging to a central log host provides a secure, centralized store for ESXi logs. You can more easily monitor all hosts with a single tool. You can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts. Logging to a secure, centralized log server helps prevent log tampering and provides a long-term audit record.
      module:

  - name: |
      .
      Control-ID: 4.1
      Title: (L1) Ensure a non-root user account exists for local admin access
      Description: By default, each ESXi host has a single "root" admin account that is used for local administration and to connect the host to vCenter Server. Use of this shared account should be limited, and named (non-root) user accounts with admin privileges should be used instead.
      Rationale: To avoid sharing a common root account, it is recommended on each host to create at least one named user account and assign it full admin privileges, and to use this account in lieu of a shared "root" account. Limit the use of "root", including setting a highly complex password for the account, but do not remove the "root" account.
      module:

  - name: |
      .
      Control-ID: 4.2
      Title: (L1) Ensure passwords are required to be complex
      Description: ESXi uses the `pam_passwdqc.so` plug-in to set password strength and complexity. Options include setting minimum password length, requiring password characters to come from particular character sets, and restricting the number of consecutive failed logon attempts permitted. The settings should enforce the organization's password policies.  Note that an uppercase character that begins a password does not count toward the number of character classes used, and neither does a number that ends a password.
      Rationale: All passwords for ESXi hosts should be hard to guess to reduce the risk of unauthorized access.  **Note:** ESXi imposes no restrictions on the root password. Password strength and complexity rules only apply to non-root users.
      module:

  - name: |
      .
      Control-ID: 4.3
      Title: (L1) Ensure Active Directory is used for local user authentication
      Description: ESXi can be configured to use a directory service such as Active Directory to manage users and groups. It is recommended that a directory service be used.  **Note:** If the AD group "ESX Admins" (default) is created, all users and groups that are members of this group will have full administrative access to all ESXi hosts in the domain.
      Rationale: Joining ESXi hosts to an Active Directory (AD) domain eliminates the need to create and maintain multiple local user accounts. Using AD for user authentication simplifies the ESXi host configuration, ensures password complexity and reuse policies are enforced, and reduces the risk of security breaches and unauthorized access.
      module:

  - name: |
      .
      Control-ID: 4.4
      Title: (L1) Ensure only authorized users and groups belong to the esxAdminsGroup group
      Description: The AD group used by vSphere is defined by the `esxAdminsGroup` attribute. By default, this attribute is set to "ESX Admins". All members of the group are granted full administrative access to all ESXi hosts in the domain. Monitor AD for the creation of this group, and limit membership to highly trusted users and groups.
      Rationale: An unauthorized user or group having membership in the `esxAdminsGroup` group will have full administrative access to all ESXi hosts. Such users may compromise the confidentiality, availability, and integrity of the all ESXi hosts and the respective data and processes they influence.
      module:

  - name: |
      .
      Control-ID: 4.5
      Title: (L1) Ensure the Exception Users list is properly configured
      Description: Users who are added to the "Exception Users" list do not lose their permissions when the host enters lockdown mode. Usually you may want to add some service accounts, such as a backup agent, to the Exception Users list.
      Rationale: Users who do not require special permissions should not be exempted from lockdown mode because this increases the risk of unauthorized actions being performed, especially if a user account is compromised.
      module:

  - name: |
      .
      Control-ID: 4.6
      Title: (L1) Ensure account lockout is set to 15 minutes
      Description: An account is automatically locked after the maximum number of failed consecutive login attempts is reached. The account should be automatically unlocked after 15 minutes, otherwise administrators will need to manually unlock accounts on request by authorized users.
      Rationale: This setting reduces the inconvenience for benign users and the overhead on administrators, while also severely slowing down any brute force password guessing attacks.
      module:

  - name: |
      .
      Control-ID: 4.7
      Title: (L1) Ensure the maximum failed login attempts is set to 3
      Description: Authentication should be configured so there is a maximum number of consecutive failed login attempts for each account, at which point the account at risk will be locked out.
      Rationale: Multiple account login failures for the same account could possibly be an attacker trying to brute force guess the password.
      module:

  - name: |
      .
      Control-ID: 5.1
      Title: (L1) Ensure the DCUI timeout is set to 600 seconds or less
      Description: The Direct Console User Interface (DCUI) is used for directly logging into an ESXi host and carrying out host management tasks. This setting terminates an idle DCUI session after the specified number of seconds has elapsed.
      Rationale: Terminating idle DCUI sessions helps avoid unauthorized usage of the DCUI originating from leftover login sessions.
      module:

  - name: |
      .
      Control-ID: 5.3
      Title: (L1) Ensure the ESXi shell is disabled
      Description: The ESXi shell is an interactive command line environment available from the Direct Console User Interface (DCUI) or remotely via SSH. The ESXi shell should only be enabled on a host when running diagnostics or troubleshooting.
      Rationale: Activities performed from the ESXi shell bypass vCenter RBAC and audit controls, so the ESXi shell should only be enabled when needed to troubleshoot/resolve problems that cannot be fixed through the vSphere web client or vCLI/PowerCLI.
      module:

  - name: |
      .
      Control-ID: 5.4
      Title: (L1) Ensure SSH is disabled
      Description: The ESXi shell, when enabled, can be accessed directly from the host console through the DCUI or remotely using SSH. Disable Secure Shell (SSH) for each ESXi host to prevent remote access to the ESXi shell, and only enable SSH when needed for troubleshooting or diagnostics.
      Rationale: Remote access to the host should be limited to the vSphere Client, remote command-line tools (vCLI/PowerCLI), and through the published APIs. Under normal circumstances, remote access to the host using SSH should be disabled.
      module:

  - name: |
      .
      Control-ID: 5.5
      Title: (L1) Ensure CIM access is limited
      Description: The Common Information Model (CIM) system provides an interface that enables hardware-level management from remote applications using a set of standard APIs. Provide only the minimum access necessary to applications. Do not provision CIM-based hardware monitoring tools and other third-party applications to run as root or as another administrator account. Instead, create a dedicated service account specific to each CIM application with the minimal access and privileges needed for that application.
      Rationale: If CIM-based hardware monitoring tools or other third-party applications are granted unneeded administrator level access, they could potentially be used to compromise the security of the host.
      module:

  - name: |
      .
      Control-ID: 5.6
      Title: (L1) Ensure Lockdown mode is enabled
      Description: Enabling lockdown mode disables direct local access to an ESXi host, requiring the host be managed remotely from vCenter Server.  There are some operations, such as backup and troubleshooting, that require direct access to the host. In these cases, lockdown mode can be disabled on a temporary basis for specific hosts as needed, and then re-enabled when the task is completed.  Note: Lockdown mode does not apply to users who log in using authorized keys. Also, users in the DCUI.Access list for each host are allowed to override lockdown mode and log in to the DCUI. By default, the "root" user is the only user listed in the DCUI.Access list.
      Rationale: Lockdown mode limits ESXi host access to the vCenter server to ensure the roles and access controls implemented in vCenter are always enforced and users cannot bypass them by logging into a host directly. By forcing all interaction to occur through vCenter Server, the risk of someone inadvertently attaining elevated privileges or performing tasks that are not properly audited is greatly reduced.
      module:

  - name: |
      .
      Control-ID: 5.8
      Title: (L1) Ensure idle ESXi shell and SSH sessions time out after 300 seconds or less
      Description: The `ESXiShellInteractiveTimeOut` allows you to automatically terminate idle ESXi shell and SSH sessions. The permitted idle time should be 300 seconds or less.
      Rationale: If a user forgets to log out of an ESXi shell or SSH session, the idle session will exist indefinitely, increasing the potential for someone to gain unauthorized privileged access to the host, unless a timeout is set.
      module:

  - name: |
      .
      Control-ID: 5.9
      Title: (L1) Ensure the shell services timeout is set to 1 hour or less
      Description: When the ESXi shell or SSH services are enabled on a host, they will run indefinitely. To avoid this, set the `ESXiShellTimeOut`, which defines a window of time after which the ESXi shell and SSH services will automatically be terminated.  It is recommended to set the `ESXiShellInteractiveTimeOut` together with `ESXiShellTimeOut`.
      Rationale: This reduces the risk of an inactive ESXi shell or SSH service being misused by an unauthorized party to compromise a host.
      module:

  - name: |
      .
      Control-ID: 5.10
      Title: (L1) Ensure DCUI has a trusted users list for lockdown mode
      Description: Lockdown mode disables direct host access, requiring admins to manage hosts from vCenter. Set DCUI.Access to a list of highly trusted users who would be able to override lockdown mode and access the DCUI in the event an ESXi host became isolated from vCenter.  **NOTE:** If you disable lockdown mode using the DCUI, all users with the DCUI.Access privilege will be granted the Administrator role on the host.
      Rationale: The list prevents all admins from becoming locked out and no longer being able to manage the host.
      module:

  - name: |
      .
      Control-ID: 6.1
      Title: (L1) Ensure bidirectional CHAP authentication for iSCSI traffic is enabled
      Description: vSphere allows for the use of bidirectional authentication of both the iSCSI target and host. Bidirectional Challenge-Handshake Authentication Protocol (CHAP), also known as Mutual CHAP, should be enabled to provide bidirectional authentication.
      Rationale: By not authenticating both the iSCSI target and host, there is a potential for a man-in-the-middle attack in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication can mitigate this risk.  **Note:** Choosing not to enforce bidirectional authentication can make sense if you create a dedicated network or VLAN to service all your iSCSI devices. If the iSCSI facility is isolated from general network traffic, it is less vulnerable to exploitation.
      module:

  - name: |
      .
      Control-ID: 6.2
      Title: (L1) Ensure the uniqueness of CHAP authentication secrets for iSCSI traffic
      Description: Challenge-Handshake Authentication Protocol (CHAP) requires both client and host to know the secret (password) to establish a connection. Each mutual authentication secret should be unique.
      Rationale: If all mutual authentication secrets are unique, compromise of one secret does not allow an attacker to authenticate to other hosts or clients using that same secret.
      module:

  - name: |
      .
      Control-ID: 6.3
      Title: (L1) Ensure storage area network (SAN) resources are segregated properly
      Description: Use zoning and logical unit number (LUN) masking to segregate storage area network (SAN) activity.   Zoning provides access control in the SAN topology. Zoning defines which host bus adapters (HBAs) can connect to which targets. The devices outside a zone are not visible to the devices inside the zone when SAN zoning is configured. For example, zones defined for testing should be managed independently within the SAN so they do not interfere with activity in the production zones. Similarly, you can set up different zones for different departments. Zoning must take into account any host groups that have been set up on the SAN device.   LUN masking is a process that makes a LUN available to some hosts and unavailable to other hosts.
      Rationale: Segregating SAN activity can reduce the attack surface for the SAN, prevent non-ESXi systems from accessing SANs, and  separate environments, for example, test and production environments.
      module:

  - name: |
      .
      Control-ID: 7.1
      Title: (L1) Ensure the vSwitch Forged Transmits policy is set to reject
      Description: Set the vSwitch Forged Transmits policy to reject for each vSwitch. Reject Forged Transmit can be set at the vSwitch and/or the Portgroup level. You can override switch-level settings at the Portgroup level.
      Rationale: If the virtual machine operating system changes the MAC address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network. Setting forged transmissions to accept means the virtual switch does not compare the source and effective MAC addresses. To protect against MAC address impersonation, all virtual switches should have forged transmissions set to reject.
      module:

  - name: |
      .
      Control-ID: 7.2
      Title: (L1) Ensure the vSwitch MAC Address Change policy is set to reject
      Description: Ensure the MAC Address Change policy within the vSwitch is set to reject. Reject MAC Changes can be set at the vSwitch and/or the Portgroup level. You can override switch-level settings at the Portgroup level.
      Rationale: If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.
      module:

  - name: |
      .
      Control-ID: 7.3
      Title: (L1) Ensure the vSwitch Promiscuous Mode policy is set to reject
      Description: Ensure the Promiscuous Mode Policy within the vSwitch is set to reject. Promiscuous mode can be set at the vSwitch and/or the Portgroup level. You can override switch-level settings at the Portgroup level.
      Rationale: When promiscuous mode is enabled for a virtual switch, all virtual machines connected to the dvPortgroup have the potential of reading all packets crossing that network. This could enable unauthorized access to the contents of those packets.
      module:

  - name: |
      .
      Control-ID: 7.4
      Title: (L1) Ensure port groups are not configured to the value of the native VLAN
      Description: ESXi does not use the concept of native VLAN, so do not configure port groups to use the native VLAN ID. If the default value of 1 for the native VLAN is being used, the ESXi Server virtual switch port groups should be configured with any value between 2 and 4094. Otherwise, ensure that the port group is not configured to use whatever value is set for the native VLAN.
      Rationale: Frames with VLAN specified in the port group will have a tag, but frames without a VLAN specified in the port group are not tagged and therefore will end up as belonging to the native VLAN of the physical switch. For example, frames on VLAN 1 from a Cisco physical switch will be untagged, because this is considered as the native VLAN. However, frames from ESXi specified as VLAN 1 will be tagged with a “1”; therefore, traffic from ESXi that is destined for the native VLAN will not be correctly routed (because it is tagged with a “1” instead of being untagged), and traffic from the physical switch coming from the native VLAN will not be visible (because it is not tagged). If the ESXi virtual switch port group uses the native VLAN ID, traffic from those VMs will not be visible to the native VLAN on the switch, because the switch is expecting untagged traffic.
      module:

  - name: |
      .
      Control-ID: 7.5
      Title: (L1) Ensure port groups are not configured to VLAN values reserved by upstream physical switches
      Description: Ensure that port groups are not configured to VLAN values reserved by upstream physical switches. Certain physical switches reserve certain VLAN IDs for internal purposes and often disallow traffic configured to these values. For example, Cisco Catalyst switches typically reserve VLANs 1001 through 1024 and 4094, while Nexus switches typically reserve 3968 through 4047 and 4094. Check the documentation for your specific switch.
      Rationale: Using a reserved VLAN might result in a denial of service on the network.
      module:

  - name: |
      .
      Control-ID: 7.6
      Title: (L1) Ensure port groups are not configured to VLAN 4095 except for Virtual Guest Tagging (VGT)
      Description: Port groups should not be configured to VLAN 4095 except for Virtual Guest Tagging (VGT). When a port group is set to VLAN 4095, this activates VGT mode. In this mode, the vSwitch passes all network frames to the guest virtual machine without modifying the VLAN tags, leaving it up to the guest to deal with them. VLAN 4095 should be used only if the guest has been specifically configured to manage VLAN tags itself.
      Rationale: If VGT is enabled inappropriately, it might cause a denial of service or allow a guest virtual machine to interact with traffic on an unauthorized VLAN.
      module:

  - name: |
      .
      Control-ID: 7.7
      Title: (L1) Ensure Virtual Disributed Switch Netflow traffic is sent to an authorized collector
      Description: The vSphere VDS can export Netflow information about traffic crossing the VDS. These exports are not encrypted and can contain information about the virtual network making it easier for a Man in the Middle attack to be executed successfully.
      Rationale: If Netflow export is required, verify that all VDS Netflow target systems are approved collectors by confirming the IP's are set correctly.
      module:

  - name: |
      .
      Control-ID: 7.8
      Title: (L1) Ensure port-level configuration overrides are disabled.
      Description: Port-level configuration overrides are disabled by default. Once enabled, it allows for different security to be set ignoring what is set at the Port-Group level.
      Rationale: There are cases where unique configurations are needed, but this should be monitored so it is only used when authorized. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could secretly exploit the broader access.
      module:

  - name: |
      .
      Control-ID: 8.1.1
      Title: (L1) Ensure informational messages from the VM to the VMX file are limited
      Description: Limit informational messages from the virtual machine (VM) to the virtual machine extensions (VMX) file to avoid filling the datastore. The configuration file containing these name-value pairs is limited to a size of 1 MB by default. This should be sufficient for most cases, but you can change this value if necessary, such as if large amounts of custom information are being stored in the configuration file.
      Rationale: Filling the datastore with informational messages from the VM to the VMX file could cause a denial of service.
      module:

  - name: |
      .
      Control-ID: 8.2.1
      Title: (L1) Ensure unnecessary floppy devices are disconnected
      Description: Ensure that no floppy device is connected to a virtual machine unless required. For a floppy device to be disconnected, the floppyX.present parameter should either not be present or have a value of FALSE.
      Rationale: Removing unnecessary hardware devices can reduce the number of potential attack channels and help prevent attacks.
      module:

  - name: |
      .
      Control-ID: 8.2.3
      Title: (L1) Ensure unnecessary parallel ports are disconnected
      Description: Ensure that no parallel port is connected to a virtual machine unless required. For a parallel port to be disconnected, the parallelX.present parameter should either not be present or have a value of FALSE.
      Rationale: Removing unnecessary hardware devices can reduce the number of potential attack channels and help prevent attacks.
      module:

  - name: |
      .
      Control-ID: 8.2.4
      Title: (L1) Ensure unnecessary serial ports are disconnected
      Description: Ensure that no serial port is connected to a virtual machine unless required. For a serial port to be disconnected, the serialX.present parameter should either not be present or have a value of FALSE.
      Rationale: Removing unnecessary hardware devices can reduce the number of potential attack channels and help prevent attacks.
      module:

  - name: |
      .
      Control-ID: 8.2.5
      Title: (L1) Ensure unnecessary USB devices are disconnected
      Description: Ensure that no USB device is connected to a virtual machine unless required. For a USB device to be disconnected, the usb.present parameter should either not be present or have a value of FALSE.
      Rationale: Removing unnecessary hardware devices can reduce the number of potential attack channels and help prevent attacks.
      module:

  - name: |
      .
      Control-ID: 8.2.6
      Title: (L1) Ensure unauthorized modification and disconnection of devices is disabled
      Description: In a virtual machine, users and processes without root or administrator privileges can disconnect devices, such as network adapters and CD-ROM drives, and modify device settings within the guest operating system. These actions should be prevented.
      Rationale: Disabling unauthorized modification and disconnection of devices helps prevents unauthorized changes within the guest operating system, which could be used to gain unauthorized access, cause denial of service conditions, and otherwise negatively affect the security of the guest operating system.
      module:

  - name: |
      .
      Control-ID: 8.2.7
      Title: (L1) Ensure unauthorized connection of devices is disabled
      Description: In a virtual machine, users and processes without root or administrator privileges can connect devices, such as network adapters and CD-ROM drives. This should be prevented.
      Rationale: Disabling unauthorized connection of devices helps prevents unauthorized changes within the guest operating system, which could be used to gain unauthorized access, cause denial of service conditions, and otherwise negatively affect the security of the guest operating system.
      module:

  - name: |
      .
      Control-ID: 8.2.8
      Title: (L1) Ensure PCI and PCIe device passthrough is disabled
      Description: Using the VMware DirectPath I/O feature to pass through a PCI or PCIe device to a virtual machine can result in a potential security vulnerability.
      Rationale: The vulnerability can be triggered by buggy or malicious code running in privileged mode in the guest OS, such as a device driver.
      module:

  - name: |
      .
      Control-ID: 8.3.1
      Title: (L1) Ensure unnecessary or superfluous functions inside VMs are disabled
      Description: Disable all system components that are not needed to support the application or service running on the VM. VMs often don't require as many functions as ordinary physical servers, so when virtualizing, you should evaluate whether a particular function is truly needed.
      Rationale: By disabling unnecessary system components, you reduce the number of potential attack vectors, which reduces the likelihood of compromise.
      module:

  - name: |
      .
      Control-ID: 8.3.2
      Title: (L1) Ensure use of the VM console is limited
      Description: The VM console enables you to connect to the console of a VM, in effect seeing what a monitor on a physical server would show. The VM console also provides power management and removable device connectivity controls. Instead of the VM console, use native remote management services, such as terminal services and ssh, to interact with VMs. Grant access to the VM console only when needed, and use custom roles to provide fine-grained permissions for those people who do need access. By default, the vCenter roles "Virtual Machine Power User" and "Virtual Machine Administrator" have the "Virtual Machine.Interaction.Console Interaction" privilege.
      Rationale: The VM console could be misused to eavesdrop on VM activity, cause VM outages, and negatively affect the performance of the console, especially if many VM console sessions are open simultaneously.
      module:

  - name: |
      .
      Control-ID: 8.3.3
      Title: (L1) Ensure secure protocols are used for virtual serial port access
      Description: Serial ports are interfaces for connecting peripherals to the VM. They are often used on physical systems to provide a direct, low-level connection to the console of a server. Virtual serial ports allow VMs to communicate with serial ports over networks. If virtual serial ports are needed, they should be configured to use secure protocols.
      Rationale: If virtual serial ports do not use secure protocols, the communications with those ports could be eavesdropped on, manipulated, or otherwise compromised, giving attackers sensitive information or control to unauthorized parties.
      module:

  - name: |
      .
      Control-ID: 8.3.4
      Title: (L1) Ensure templates are used whenever possible to deploy VMs
      Description: Use a hardened base operating system template image to create application-specific templates, and use the application-specific templates to deploy virtual machines.
      Rationale: By capturing a hardened base operating system image (with no applications installed) in a template, you can ensure that all your virtual machines are created with a known baseline level of security. Manual installation of the OS and applications into a VM introduces the risk of misconfiguration due to human or process error.
      module:

  - name: |
      .
      Control-ID: 8.4.1
      Title: (L1) Ensure access to VMs through the dvfilter network APIs is configured correctly
      Description: A VM must be configured explicitly to accept access by the dvfilter network API. Only VMs that need to be accessed by that API should be configured to accept such access.
      Rationale: An attacker might compromise a VM by making use of the dvfilter API.
      module:

  - name: |
      .
      Control-ID: 8.4.2
      Title: (L1) Ensure VMsafe Agent Address is configured correctly
      Description: The VMsafe CPU/memory API allows a security virtual machine to inspect and modify the contents of the memory and CPU registers on other VMs, for the purpose of detecting and preventing malware attacks. A VM must be configured explicitly to accept access by the VMsafe CPU/memory API. This involves three parameters to perform the following:  1. Enable the API. 2. Set the IP address used by the security virtual appliance on the introspection vSwitch. 3. Set the port number for that IP address.  The second parameter must be set correctly in the `vmsafe.agentAddress` option in the virtual machine configuration file for any VMs that should be protected by the API.
      Rationale: An attacker might compromise the VMs by making unauthorized use of the introspection channel provided by the API.
      module:

  - name: |
      .
      Control-ID: 8.4.3
      Title: (L1)  Ensure VMsafe Agent Port is configured correctly
      Description: The VMsafe CPU/memory API allows a security virtual machine to inspect and modify the contents of the memory and CPU registers on other VMs, for the purpose of detecting and preventing malware attacks. A VM must be configured explicitly to accept access by the VMsafe CPU/memory API. This involves three parameters to perform the following:  1. Enable the API. 2. Set the IP address used by the security virtual appliance on the introspection vSwitch. 3. Set the port number for that IP address.  The third parameter must be set correctly in the `vmsafe.agentPort` option in the virtual machine configuration file for any VMs that should be protected by the API.
      Rationale: An attacker might compromise the VMs by making unauthorized use of the introspection channel provided by the API.
      module:

  - name: |
      .
      Control-ID: 8.4.4
      Title: (L1) Ensure VMsafe Agent is configured correctly
      Description: The VMsafe CPU/memory API allows a security virtual machine to inspect and modify the contents of the memory and CPU registers on other VMs, for the purpose of detecting and preventing malware attacks. A VM must be configured explicitly to accept access by the VMsafe CPU/memory API. This involves three parameters to perform the following:  1. Enable the API. 2. Set the IP address used by the security virtual appliance on the introspection vSwitch. 3. Set the port number for that IP address.  The first parameter must be set correctly in the `vmsafe.enable` option in the virtual machine configuration file for any VMs that should be protected by the API. For any VMs that should not be protected by the API, this option should not exist in the configuration file.
      Rationale: An attacker might compromise the VMs by making unauthorized use of the introspection channel provided by the API.
      module:

  - name: |
      .
      Control-ID: 8.4.24
      Title: (L1) Ensure VM Console Copy operations are disabled
      Description: VM console copy operations should be disabled.
      Rationale: VM console copy operations are disabled by default (not explicitly specified); however, explicitly disabling this feature enables audit controls to check that this setting is correct.
      module:

  - name: |
      .
      Control-ID: 8.4.25
      Title: (L1) Ensure VM Console Drag and Drop operations is disabled
      Description: VM console drag and drop operations should be disabled.
      Rationale: VM console drag and drop operations are disabled by default (not explicitly specified); however, explicitly disabling this feature enables audit controls to check that this setting is correct.
      module:

  - name: |
      .
      Control-ID: 8.4.26
      Title: (L1) Ensure VM Console GUI Options is disabled
      Description: VM console and paste GUI options should be disabled.
      Rationale: VM console and paste GUI options are disabled by default (not explicitly specified); however, explicitly disabling this feature enables audit controls to check that this setting is correct.
      module:

  - name: |
      .
      Control-ID: 8.4.27
      Title: (L1) Ensure VM Console Paste operations are disabled
      Description: VM console paste operations should be disabled.
      Rationale: VM console paste operations are disabled by default (not explicitly specified); however, explicitly disabling this feature enables audit controls to check that this setting is correct.
      module:

  - name: |
      .
      Control-ID: 8.4.28
      Title: (L1) Ensure access to VM console via VNC protocol is limited
      Description: Minimize access to the Virtual Machine via VNC protocol.
      Rationale: The VM console enables you to connect to the console of a virtual machine, in effect seeing what a monitor on a physical server would show. This console is also available via the VNC protocol. Setting up this access also involves setting up firewall rules on each ESXi server the virtual machine will run on.
      module:

  - name: |
      .
      Control-ID: 8.6.2
      Title: (L1) Ensure virtual disk shrinking is disabled
      Description: If Virtual disk shrinking is done repeatedly it will cause the virtual disk to become unavailable resulting in a denial of service. You can prevent virtual disk shrinking by disabling it.
      Rationale: Shrinking a virtual disk reclaims unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. Normal users and processes—that is, users and processes without root or administrator privileges—within virtual machines have the capability to invoke this procedure. However, if this is done repeatedly, the virtual disk can become unavailable while this shrinking is being performed, effectively causing a denial of service. In most datacenter environments, disk shrinking is not done, so you should disable this feature. Repeated disk shrinking can make a virtual disk unavailable. This capability is available to nonadministrative users in the guest.
      module:

  - name: |
      .
      Control-ID: 8.6.3
      Title: (L1) Ensure virtual disk wiping is disabled
      Description: Wiping a virtual disk reclaims all unused space in it. If there is empty space in the disk, this process reduces the amount of space the virtual disk occupies on the host drive. If virtual disk wiping is done repeatedly, it can cause the virtual disk to become unavailable while wiping occurs. In most datacenter environments, disk wiping is not needed, but normal users and processes--without administrative privileges--can issue disk wipes unless the feature is disabled.
      Rationale: Virtual disk wiping can effectively cause a denial of service.
      module:

  - name: |
      .
      Control-ID: 8.7.2
      Title: (L1) Ensure the number of VM log files is configured properly
      Description: Normally a new log file is created only when a host is rebooted, so the file can grow to be quite large. You can ensure that new log files are created more frequently by limiting the maximum size of the log files. If you want to restrict the total size of logging data, VMware recommends saving 10 log files, each one limited to 1 MB. Each time an entry is written to the log, the size of the log is checked; if it is over the limit, the next entry is written to a new log. If the maximum number of log files already exists, when a new one is created, the oldest log file is deleted.
      Rationale: Log files should be rotated to preserve log data in case of corruption or destruction of the current log file, and to avoid the likelihood of logging issues caused by an overly large log file.
      module:

  - name: |
      .
      Control-ID: 8.7.4
      Title: (L1) Ensure VM log file size is limited
      Description: Normally a new log file is created only when a host is rebooted, so the file can grow to be quite large. You can ensure that new log files are created more frequently by limiting the maximum size of the log files. If you want to restrict the total size of logging data, VMware recommends saving 10 log files, each one limited to 1 MB. If the maximum number of log files already exists, when a new one is created, the oldest log file is deleted.
      Rationale: Virtual machine users and processes can abuse logging either on purpose or inadvertently so that large amounts of data flood the log file. Without restrictions on maximum log file size, over time a log file can consume enough file system space to cause a denial of service.
      module:

...